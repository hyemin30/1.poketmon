<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>í¬ì¼“ëª¬ë¹µì°¾ê¸°</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>


    <style>
        *{
            font-family: 'Jua', sans-serif;
        }
        h1{
            color: #0d62fd;
        }
        .login-and-out{
            width: 300px;
            margin: 30px 0px 50px auto;
        }
        .title{
            text-align: center;
            margin: 120px 0px 30px 0px;
            font-size: 3rem;
        }
        .mybtn{
            width: 550px;
            margin:50px auto 50px auto;
        }
        .container {
            margin-left: 50px;
        }
        .name{
            color: #3B44F6;
        }
        .stock{
            color:#D61C4E;
        }
        .poketmon {
            color: #FED049;
            font-size: 5rem;
        }

    </style>
    <script>
        $(document).ready(function () {
            listing();
        });

        //ì „ì²´ì¡°íšŒ
        function listing(){
            $('#cards-box').empty()
            $.ajax({
                type: "GET",
                url: "/poketmon",
                data: {},
                success: function (response) {
                    let rows = response['poketmons']
                    for (let i=0; i < rows.length; i++){
                        let img = rows[i]['image']
                        let name = rows[i]['name']
                        let store = rows[i]['store']
                        let stock = rows[i]['stock']
                        let num = rows[i]['num']
                        let temp_html = ''
                        if (stock == 0) {
                            temp_html = `<div class="card" style="width: 270px;">
                                              <img src="${img}" class="card-img-top" alt="ë¹µì´ë¯¸ì§€${i}ë²ˆì§¸">
                                              <div class="card-body">
                                                <h5 class="card-title name">${name}</h5>
                                                <p class="card-text">${store} <span class="stock">&nbsp&nbsp&nbspì¬ê³  ${stock} ê°œ</span> </p>
                                                <div class="alert alert-danger" role="alert">
                                                  ì¬ê³ ê°€ ì—†ì–´ìš”! ğŸ˜­
                                                </div>
                                             </div>
                                        </div>`

                        } else {
                            temp_html = `<div class="card" style="width: 270px;">
                                              <img src="${img}" class="card-img-top" alt="ë¹µì´ë¯¸ì§€${i}ë²ˆì§¸">
                                              <div class="card-body">
                                                <h5 class="card-title name">${name}</h5>
                                                <p class="card-text">${store} <span class="stock">&nbsp&nbsp&nbspì¬ê³  ${stock} ê°œ</span> </p>
                                              <button type="button" class="btn btn-outline-danger" onclick="reservation(${num})"> ì§€ê¸ˆë°”ë¡œ ì˜ˆì•½í•˜ê¸°â¤ï¸</button>
                                              </div>
                                        </div>`
                            }

                        $('#cards-box').append(temp_html)
                    }
                }
            });
        }

        //ê²€ìƒ‰ì¡°íšŒ
        function search(){
            let count = 0;
            let keyword = $('#keyword').val()
            if (keyword == '') {
                count = -1;
                alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”')
            }else{
                $('#cards-box').empty()
            }

            $.ajax({
                type: "GET",
                url: "/search",
                data: {},
                success: function (response) {
                    let rows = response['poketmon_list']
                    for (let i=0; i < rows.length; i++){
                        let img = rows[i]['image']
                        let name = rows[i]['name']
                        let store = rows[i]['store']
                        let stock = rows[i]['stock']
                        if(name==keyword){
                            let temp_html = `<div class="card" id="${i}" style="width: 270px;">
                                              <img src="${img}" class="card-img-top image" alt="ë¹µì´ë¯¸ì§€${i}ë²ˆì§¸">
                                              <div class="card-body reservation">
                                              <h5 class="card-title" id="bread-name">${name}</h5>
                                                <p class="card-text">${store} <span class="stock">&nbsp&nbsp&nbspì¬ê³  ${stock} ê°œ</span> </p>
                                              <button type="button" class="btn btn-outline-danger"> ì§€ê¸ˆë°”ë¡œ ì˜ˆì•½í•˜ê¸°</button>
                                              </div>
                                        </div>`
                        $('#cards-box').append(temp_html)
                        count += 1
                        }
                    }

                    if(count ==0){
                        alert('ì¡°íšŒê²°ê³¼ì—†ìŒ')
                        listing();

                    }

                }
            });
        }

        function reservation_list() {
             if (document.cookie == '') {
                alert('ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”')
                location.href = 'login'
            }else{
                 location.href='reservation-list'
             }
        }

        //ì˜ˆì•½í•˜ê¸°
        function reservation(num) {
            let username = document.cookie.split('=')[1]
            let today = new Date()
            let date = today.getFullYear() + '-' + (today.getMonth()+1) + '-' + today.getDate()
            if (document.cookie == '') {
                alert('ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”')
                location.href = 'login'
            }else{
                alert(num)
                $.ajax({
                    type: "POST",
                    url: "/reservation",
                    data: {num_give: num, username_give: username, date_give: date},
                    success: function (response) {
                        alert(response['msg'])
                        location.reload()
                    }
                });

            }



        }

         //ë¡œê·¸ì•„ì›ƒ
        function logout(){
                //console.log("ì‘ë™í•¨")
                $.ajax({
                    type: "GET",
                    url: "/delcookie",
                    data: {},
                    success: function (response) {
                        alert(response['msg'])
                    }
                })
        }


        //ë¡œê·¸ì¸í• ë•Œ..
        function login() {
            if (document.cookie == '') {
                location.href = 'login'
            } else {
                alert('ì´ë¯¸ ë¡œê·¸ì¸ ë˜ì–´ìˆìŠµë‹ˆë‹¤')
            }
        }

          function signup() {
            if (document.cookie == '') {
                location.href = 'signup'
            } else {
                alert('ë¨¼ì € ë¡œê·¸ì•„ì›ƒí•˜ì„¸ìš”')
           }
        }
         // í˜„ì¤€
        function ask() {
            alert('ë¬¸ì˜í• ê¹Œìš”?')
            document.id.action="ask.html";
        }

    </script>


</head>
<body>

    <nav class="nav nav-pills nav-fill">
      <a class="nav-link active" aria-current="page" href="index">í¬ì¼“ëª¬ë¹µì°¾ê¸°</a>
<!--      <a class="nav-link" onclick="reservation()">ì˜ˆì•½í•˜ê¸°</a>-->
      <a class="nav-link" onclick="reservation_list()">ì˜ˆì•½ì¡°íšŒ</a>
      <a class="nav-link" href="ask">ë¬¸ì˜í•˜ê¸°</a>
        <div class="btn-group" role="group" aria-label="Basic outlined example">
            <button type="button" class="btn btn-outline-primary" onclick="login()">ë¡œê·¸ì¸</button>
            <button type="button" class="btn btn-outline-primary" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            <a class="btn btn-outline-primary" onclick="signup()">íšŒì›ê°€ì…</a>
        </div>
    </nav>



    <h1 class="title">ë‚´ ì£¼ë³€ <span class="poketmon">í¬ì¼“ëª¬ë¹µ</span>ì„ ì°¾ê³  ì˜ˆì•½í•´ë³´ì„¸ìš”</h1>

    <div class="container">
        <div class="mybtn">
            <input type="text" id="keyword">
            <button type="button" class="btn btn-dark" onclick="search()">í¬ì¼“ëª¬ë¹µ ê²€ìƒ‰</button>
<!--            <button type="button" class="btn btn-outline-dark">ë“±ë¡(ì„ì‹œ)</button>-->
        </div>
        <div id="cards-box" class="row row-cols-1 row-cols-md-4 g-4">
            <div class="card " style="width: 18rem;">
                <img src="..." class="card-img-top cards-box" alt="í¬ì¼“ëª¬ë¹µì´ë¯¸ì§€">
                <div class="card-body">
                    <h5 class="card-title">í¬ì¼“ëª¬ë¹µì´ë¦„</h5>
                    <p class="card-text">í¸ì˜ì ì •ë³´</p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>